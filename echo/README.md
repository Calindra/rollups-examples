# Simple Echo DApp

This example shows how to interact through the Cartesi Rollups with a Simple Echo DApp written in Python that is running inside a Cartesi Machine.
The goal of this example is to show how to send inputs to the DApp and check if they were processed.

## Echo

To run the echo example, clone the repo as follows:

```shell
$ git clone --recurse-submodules git@github.com:cartesi/rollups-examples.git
```

Then, run a script to generate the binaries for the echo example:

```shell
$ cd rollups-examples/echo
$ make -C server
```

Start the containers:

```shell
$ docker-compose up
```

Wait for the hardhat container to start and create the rollup onchain infrastructure:

```shell
$ docker exec echo_hardhat_1 npx hardhat --network localhost rollups:create --export dapp.json
```

You'll know this was created when this command shows you the following reply:

```shell
Rollups Impl address: 0xa513E6E4b8f2a923D98304ec87F64353C4D5C853
Rollups Impl getCurrentEpoch: 0
Rollups accumulation start: 1640643011
Input address 0x9bd03768a7DCc129555dE410FF8E85528A4F88b5
Output address 0x440C0fCDC317D69606eabc35C0F676D1a8251Ee1
Ether Portal address 0x8A791620dd6260079BF849Dc5567aDC3F2FdC318
ERC20 Portal address 0x2279B7A0a67DB372996a5FaB50D91eAA73d2eBe6
```

To send an input, open a new terminal window and run:

```shell
$ docker exec echo_hardhat_1 npx hardhat --network localhost input:addInput --input "0x636172746573690D0A"
```

You'll know the input was accepted when the terminal shows you something like following reply:

```shell
Added input '0x636172746573690D0A' to epoch '0' (timestamp: 1640643170, signer: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266, tx: 0x31d7e9e810d8702196623837b8512097786b544a4b5ffb52f693b9ff7d424147)
```

In order to verify the notices generated by your inputs, run the command:

```shell
$ curl -v http://localhost:4000/graphql -H 'Content-Type: application/json' -d '{ "query" : "query getNotice { GetNotice( query: { session_id: \"default_rollups_id\", epoch_index: \"0\", input_index: \"0\" } ) { session_id epoch_index input_index notice_index payload } }" }'
```

The response should be something like:

```shell
*   Trying 127.0.0.1:4000...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 4000 (#0)
> POST /graphql HTTP/1.1
> Host: localhost:4000
> User-Agent: curl/7.68.0
> Accept: */*
> Content-Type: application/json
> Content-Length: 251
>
* upload completely sent off: 251 out of 251 bytes
* Mark bundle as not supporting multiuse
< HTTP/1.1 200 OK
< X-Powered-By: Express
< Access-Control-Allow-Origin: *
< Content-Type: application/json; charset=utf-8
< Content-Lengt
```

To stop the containers, first end the process with `Ctrl + C`, then remove the volumes as follows:

```shell
$ docker-compose down --volumes
```

The HTTP API uses two different ports, to receive and send information.
They're respectively: `5002` and `5003`.

To advance time, in order to simulate the passing of epochs, run:

```shell
$ docker exec echo_hardhat_1 npx hardhat --network localhostutil:advanceTime --seconds 864010
```
